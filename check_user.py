import os
import sys
import django

# Fix encoding for Windows console to support Arabic and emojis
if sys.platform == 'win32':
    sys.stdout.reconfigure(encoding='utf-8')
    sys.stderr.reconfigure(encoding='utf-8')

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')
django.setup()

from django.contrib.auth.models import User
from django.contrib.auth import authenticate

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ†
print("=" * 60)
print("Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…:")
print("=" * 60)

users = User.objects.all()
for user in users:
    print(f"\nğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {user.username}")
    print(f"   Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: {user.email}")
    print(f"   Ù…Ø¯ÙŠØ±ØŸ: {'Ù†Ø¹Ù… âœ…' if user.is_superuser else 'Ù„Ø§'}")
    print(f"   Ù†Ø´Ø·ØŸ: {'Ù†Ø¹Ù… âœ…' if user.is_active else 'Ù„Ø§ âŒ'}")
    print(f"   ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„: {user.last_login}")

print("\n" + "=" * 60)
print("Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:")
print("=" * 60)

# Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
username = 'admin'
password = 'Radwa@01000'

user = authenticate(username=username, password=password)
if user is not None:
    print(f"âœ… Ù†Ø¬Ø­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: {username}")
    print(f"   ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± '{password}' ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!")
else:
    print(f"âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: {username}")
    print(f"   ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± '{password}' ØºÙŠØ± ØµØ­ÙŠØ­Ø©!")
    print("\nğŸ”„ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰...")
    
    try:
        user = User.objects.get(username=username)
        user.set_password(password)
        user.is_active = True  # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ø´Ø·
        user.save()
        print(f"âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­")
        
        # Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
        user = authenticate(username=username, password=password)
        if user is not None:
            print(f"âœ… Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!")
        else:
            print(f"âŒ Ù„Ø§ ÙŠØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£: {e}")

print("\n" + "=" * 60)
